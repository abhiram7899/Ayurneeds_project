<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f2f5; margin: 0; }
        .login-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        h2 { color: #2c3e50; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 20px; font-size: 14px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        input:focus { border-color: #27ae60; outline: none; }
        .btn { width: 100%; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { background: #219150; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .error-msg { color: #e74c3c; font-size: 14px; margin-top: 15px; display: none; background: #fde8e8; padding: 10px; border-radius: 5px; border: 1px solid #fcc; }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo">
        <img src="images/logo.png" alt="Ayurneeds Logo"></a>
        <div class="nav-links">
            <a href="index.html" class="nav-btn nav-primary">Home</a>
            <a href="contact.html" class="nav-btn">Contact</a>
            <a href="about.html" class="nav-btn">About</a>
            <a href="store.html" class="nav-btn">Store</a> 
            <a href="track.html" class="nav-btn">Track Order</a>
            <span class="nav-btn ">Logged In</span>
        </div>
    </header>

<div class="login-card">
    <h2>üîê Secure Access</h2>
    <p>For security, please enter your registered mobile number to view your prescription.</p>

    <input type="tel" id="phoneInput" placeholder="Enter Phone Number" onkeypress="handleEnter(event)">
    <button id="loginBtn" class="btn" onclick="verifyAndLogin()">View Prescription</button>

    <div id="errorBox" class="error-msg"></div>
</div>

<script>
    // ‚úÖ Live Render Backend URL
    const API_URL = "https://ayurneeds.com"; 
    
    const urlParams = new URLSearchParams(window.location.search);
    const presId = urlParams.get('id');

    function handleEnter(e) {
        if(e.key === 'Enter') verifyAndLogin();
    }

    async function verifyAndLogin() {
        const phone = document.getElementById('phoneInput').value;
        const errorBox = document.getElementById('errorBox');
        const btn = document.getElementById('loginBtn');

        errorBox.style.display = 'none';
        
        if (!presId) { 
            showError("Invalid Link. Please ask the doctor to resend it."); 
            return; 
        }
        if (!phone) { 
            showError("Please enter your phone number."); 
            return; 
        }

        btn.innerText = "Verifying...";
        btn.disabled = true;

        try {
            const response = await fetch(`${API_URL}/verify-patient/${presId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone: phone })
            });

            if (response.ok) {
                window.location.href = `patient_dashboard.html?id=${presId}`;
            } else {
                showError("‚ö†Ô∏è Number not registered. Please enter the number given to the doctor.");
                btn.innerText = "View Prescription";
                btn.disabled = false;
            }
        } catch (err) {
            showError("‚ùå Server Error. Please check your internet connection.");
            btn.innerText = "View Prescription";
            btn.disabled = false;
        }
    }

    function showError(msg) {
        const box = document.getElementById('errorBox');
        box.innerText = msg;
        box.style.display = 'block';
    }
</script>

</body>
</html>